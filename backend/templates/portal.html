{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Dashboard - StudentNest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700;800;900&display=swap" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #fff;
    }

    /* Navigation Bar */
    .dashboard-nav {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.18);
      padding: 16px 0;
    }

    .dashboard-nav-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .dashboard-logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      font-weight: 800;
      color: white;
      text-decoration: none;
    }

    .dashboard-nav-links {
      display: flex;
      gap: 24px;
      align-items: center;
    }

    .dashboard-nav-link {
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      font-weight: 500;
      font-size: 15px;
      transition: all 0.2s ease;
      padding: 8px 16px;
      border-radius: 8px;
    }

    .dashboard-nav-link:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .dashboard-nav-link.active {
      background: rgba(255, 255, 255, 0.2);
      font-weight: 600;
    }

    .dashboard-logout-btn {
      padding: 10px 24px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .dashboard-logout-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    /* Message Badge */
    .message-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      background: #ff4757;
      color: white;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 700;
      margin-left: 8px;
    }

    /* Messages Section - Chat Room Style */
    .messages-container {
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 20px;
      height: 700px;
    }

    .messages-list {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 12px;
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .conversations-header {
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 12px;
    }

    .conversations-header h3 {
      font-size: 16px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
    }

    .conversations-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
    }

    .conversations-scroll::-webkit-scrollbar {
      width: 6px;
    }

    .conversations-scroll::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    .conversations-scroll::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    .message-item {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .message-item:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateX(2px);
    }

    .message-item.active {
      background: rgba(102, 126, 234, 0.25);
      border-color: rgba(102, 126, 234, 0.5);
    }

    .message-item.unread::after {
      content: '';
      position: absolute;
      top: 14px;
      right: 14px;
      width: 10px;
      height: 10px;
      background: #ff4757;
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(255, 71, 87, 0.6);
    }

    .message-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .message-sender {
      font-weight: 600;
      font-size: 14px;
      color: white;
    }

    .message-time {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.6);
    }

    .message-subject {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 4px;
      font-weight: 500;
    }

    .message-preview {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .message-room {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .messages-content {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-header {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(255, 255, 255, 0.05);
    }

    .chat-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      flex-shrink: 0;
    }

    .chat-header-info {
      flex: 1;
    }

    .chat-header-info h3 {
      font-size: 17px;
      margin-bottom: 2px;
    }

    .chat-header-info p {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .chat-messages::-webkit-scrollbar {
      width: 8px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }

    .chat-message {
      display: flex;
      gap: 12px;
      max-width: 70%;
    }

    .chat-message.sent {
      margin-left: auto;
      flex-direction: row-reverse;
    }

    .chat-message-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      flex-shrink: 0;
    }

    .chat-message.sent .chat-message-avatar {
      background: linear-gradient(135deg, #f093fb, #f5576c);
    }

    .chat-message-content {
      flex: 1;
    }

    .chat-message-bubble {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      border-top-left-radius: 4px;
      padding: 12px 16px;
      color: white;
      line-height: 1.5;
      font-size: 14px;
      word-wrap: break-word;
    }

    .chat-message.sent .chat-message-bubble {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 16px;
      border-top-right-radius: 4px;
      border-top-left-radius: 16px;
    }

    .chat-message-time {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 4px;
      padding: 0 4px;
    }

    .message-detail-header {
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }

    .message-detail-sender {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .message-detail-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
    }

    .message-detail-info h3 {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .message-detail-info p {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
    }

    .message-detail-subject {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .message-detail-body {
      flex: 1;
      padding: 20px 0;
      line-height: 1.6;
      font-size: 15px;
      color: rgba(255, 255, 255, 0.9);
    }

    .chat-input-section {
      padding: 16px 24px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .chat-input-wrapper {
      flex: 1;
      position: relative;
    }

    .chat-input {
      width: 100%;
      min-height: 50px;
      max-height: 120px;
      padding: 14px 16px;
      padding-right: 50px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      font-family: inherit;
      font-size: 14px;
      resize: none;
      overflow-y: auto;
    }

    .chat-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .chat-input:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.6);
      background: rgba(255, 255, 255, 0.15);
    }

    .chat-send-btn {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .chat-send-btn:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .message-reply-section {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 20px;
    }

    .message-reply-textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
      margin-bottom: 12px;
    }

    .message-reply-textarea::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .message-reply-textarea:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.15);
    }

    .message-reply-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .message-reply-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .message-reply-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .messages-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 60px 20px;
      color: rgba(255, 255, 255, 0.6);
    }

    .messages-empty svg {
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .messages-empty h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: white;
    }

    /* My Rooms Section */
    .dashboard-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 32px;
    }

    .dashboard-section-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .my-rooms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .my-room-card {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.3s ease;
      position: relative;
    }

    .my-room-card:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    }

    .my-room-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: rgba(255, 255, 255, 0.1);
    }

    .my-room-content {
      padding: 20px;
    }

    .my-room-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
      color: white;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .my-room-location {
      font-size: 14px;
      opacity: 0.85;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .my-room-price {
      font-size: 24px;
      font-weight: 800;
      font-family: 'Orbitron', sans-serif;
      color: #4ade80;
      margin-bottom: 16px;
    }

    .my-room-actions {
      display: flex;
      gap: 12px;
    }

    .my-room-btn {
      flex: 1;
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .my-room-btn-view {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .my-room-btn-view:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .my-room-btn-delete {
      background: rgba(220, 53, 69, 0.8);
      color: white;
    }

    .my-room-btn-delete:hover {
      background: rgba(220, 53, 69, 1);
      transform: translateY(-2px);
    }

    .my-rooms-empty {
      text-align: center;
      padding: 60px 20px;
      opacity: 0.8;
    }

    .my-rooms-empty svg {
      margin: 0 auto 20px;
      opacity: 0.5;
    }

    .my-rooms-empty h3 {
      font-size: 20px;
      margin-bottom: 12px;
    }

    .my-rooms-empty p {
      font-size: 16px;
      margin-bottom: 24px;
    }

    .my-rooms-empty a {
      display: inline-block;
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .my-rooms-empty a:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    /* Reports Grid */
    .reports-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .report-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 16px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .report-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    }

    .report-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 16px;
    }

    .report-type-badge {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .report-status-badge {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
    }

    .report-status-pending { background: #ffc107; color: #000; }
    .report-status-under_review { background: #17a2b8; color: #fff; }
    .report-status-resolved { background: #28a745; color: #fff; }
    .report-status-dismissed { background: #6c757d; color: #fff; }

    .report-card-body {
      margin: 16px 0;
    }

    .report-room-info {
      background: rgba(255, 255, 255, 0.05);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .report-room-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .report-room-details {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
    }

    .report-description {
      font-size: 14px;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.85);
      margin-top: 12px;
      max-height: 100px;
      overflow-y: auto;
    }

    .report-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
    }

    /* Main Container */
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    /* Welcome Section */
    .dashboard-welcome {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 32px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .dashboard-welcome-title {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(28px, 4vw, 42px);
      font-weight: 800;
      margin-bottom: 12px;
    }

    .dashboard-welcome-subtitle {
      font-size: 18px;
      opacity: 0.9;
      margin-bottom: 24px;
    }

    .dashboard-welcome-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      margin-top: 32px;
    }

    .dashboard-stat-card {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .dashboard-stat-card:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-4px);
    }

    .dashboard-stat-icon {
      width: 56px;
      height: 56px;
      margin: 0 auto 16px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dashboard-stat-number {
      font-size: 36px;
      font-weight: 800;
      font-family: 'Orbitron', sans-serif;
      margin-bottom: 8px;
    }

    .dashboard-stat-label {
      font-size: 14px;
      opacity: 0.85;
      font-weight: 500;
    }

    /* Quick Actions */
    .dashboard-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .dashboard-action-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 20px;
      padding: 32px;
      text-decoration: none;
      color: white;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .dashboard-action-card:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-8px);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
    }

    .dashboard-action-icon {
      width: 72px;
      height: 72px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }

    .dashboard-action-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .dashboard-action-text {
      font-size: 14px;
      opacity: 0.85;
      line-height: 1.6;
    }

    /* Recent Activity */
    .dashboard-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 32px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .dashboard-section-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 24px;
      font-family: 'Orbitron', sans-serif;
    }

    .dashboard-activity-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .dashboard-activity-item {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      transition: all 0.2s ease;
    }

    .dashboard-activity-item:hover {
      background: rgba(255, 255, 255, 0.12);
    }

    .dashboard-activity-icon {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .dashboard-activity-content {
      flex: 1;
    }

    .dashboard-activity-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .dashboard-activity-time {
      font-size: 13px;
      opacity: 0.7;
    }

    .dashboard-tab.active {
      color: #fff !important;
      border-bottom-color: #4a9eff !important;
    }

    .dashboard-tab:hover {
      color: rgba(255, 255, 255, 0.9);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .dashboard-nav-links {
        display: none;
      }

      .dashboard-container {
        padding: 24px 16px;
      }

      .dashboard-welcome {
        padding: 24px;
      }

      .dashboard-actions {
        grid-template-columns: 1fr;
      }
    }

    /* Mobile Menu Toggle */
    .dashboard-mobile-toggle {
      display: none;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 8px;
    }

    @media (max-width: 768px) {
      .dashboard-mobile-toggle {
        display: block;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="dashboard-nav">
    <div class="dashboard-nav-container">
      <a href="home.html" class="dashboard-logo">StudentNest</a>
      <div class="dashboard-nav-links">
        <a href="home.html" class="dashboard-nav-link">Home</a>
        <a href="portal.html" class="dashboard-nav-link active">Dashboard</a>
        <a href="#" class="dashboard-nav-link">My Bookings</a>
        <a href="#messages-section" class="dashboard-nav-link" id="messagesNavLink">
          Messages
          <span class="message-badge" id="unreadBadge" style="display: none;">0</span>
        </a>
        <button class="dashboard-logout-btn" id="logoutBtn">Logout</button>
      </div>
      <button class="dashboard-mobile-toggle" id="mobileToggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Main Dashboard -->
  <div class="dashboard-container">
    <!-- Welcome Section -->
    <div class="dashboard-welcome">
      <h1 class="dashboard-welcome-title">Welcome back, <span id="userName">Student</span>! üëã</h1>
      <p class="dashboard-welcome-subtitle">Here's what's happening with your student accommodation journey</p>
      
      <div class="dashboard-welcome-stats">
        <div class="dashboard-stat-card">
          <div class="dashboard-stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            </svg>
          </div>
          <div class="dashboard-stat-number">12</div>
          <div class="dashboard-stat-label">Saved Properties</div>
        </div>
        <div class="dashboard-stat-card">
          <div class="dashboard-stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <div class="dashboard-stat-number">5</div>
          <div class="dashboard-stat-label">Active Chats</div>
        </div>
        <div class="dashboard-stat-card">
          <div class="dashboard-stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
          <div class="dashboard-stat-number">3</div>
          <div class="dashboard-stat-label">Upcoming Viewings</div>
        </div>
        <div class="dashboard-stat-card">
          <div class="dashboard-stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
          </div>
          <div class="dashboard-stat-number">8</div>
          <div class="dashboard-stat-label">Potential Flatmates</div>
        </div>
      </div>
    </div>

    <!-- Section Tabs -->
    <div class="dashboard-tabs" style="display: flex; gap: 12px; margin: 24px 0; border-bottom: 2px solid rgba(255, 255, 255, 0.1); padding-bottom: 0; overflow-x: auto;">
      <button class="dashboard-tab active" onclick="showSection('favorites')" style="padding: 12px 20px; background: none; border: none; color: rgba(255, 255, 255, 0.7); font-size: 16px; font-weight: 500; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; white-space: nowrap;">
        Favorites
      </button>
      <button class="dashboard-tab" onclick="showSection('myrooms')" style="padding: 12px 20px; background: none; border: none; color: rgba(255, 255, 255, 0.7); font-size: 16px; font-weight: 500; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; white-space: nowrap;">
        My Rooms
      </button>
      <button class="dashboard-tab" onclick="showSection('reports')" style="padding: 12px 20px; background: none; border: none; color: rgba(255, 255, 255, 0.7); font-size: 16px; font-weight: 500; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; white-space: nowrap;">
        My Reports
      </button>
    </div>

    <!-- Favorite Rooms Section -->
    <div class="dashboard-section" id="favoritesSection">
      <h2 class="dashboard-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path>
        </svg>
        My Favorite Rooms
        <span id="favoritesCount" style="font-size: 16px; font-weight: 400; color: rgba(255, 255, 255, 0.7);"></span>
      </h2>
      <div id="favoritesGrid" class="my-rooms-grid">
        <!-- Favorite rooms will be loaded here -->
      </div>
      <div id="favoritesEmpty" class="my-rooms-empty" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path>
        </svg>
        <h3>No Favorite Rooms Yet</h3>
        <p>You haven't saved any rooms yet. Browse available rooms and click the heart icon to save your favorites.</p>
        <a href="home.html">Browse Rooms</a>
      </div>
    </div>

    <!-- My Rooms Section -->
    <div class="dashboard-section" id="myRoomsSection" style="display: none;">
      <h2 class="dashboard-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        My Posted Rooms
      </h2>
      <div id="myRoomsGrid" class="my-rooms-grid">
        <!-- Rooms will be loaded here -->
      </div>
      <div id="myRoomsEmpty" class="my-rooms-empty" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <h3>No Rooms Posted Yet</h3>
        <p>You haven't posted any rooms. Start listing your property to connect with students.</p>
        <a href="post-room.html">Post Your First Room</a>
      </div>
    </div>

    <!-- My Reports Section -->
    <div class="dashboard-section" id="reportsSection" style="display: none;">
      <h2 class="dashboard-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        My Reports
      </h2>
      <div id="reportsGrid" class="reports-grid">
        <!-- Reports will be loaded here -->
      </div>
      <div id="reportsEmpty" class="my-rooms-empty" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <h3>No Reports Submitted</h3>
        <p>You haven't reported any issues yet. If you encounter a problem with a listing, you can report it from the room details page.</p>
      </div>
    </div>

    <!-- Messages Section -->
    <div class="dashboard-section" id="messages-section">
      <h2 class="dashboard-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        My Conversations
        <span id="messagesTotalCount" style="font-size: 16px; font-weight: 400; color: rgba(255, 255, 255, 0.7);"></span>
      </h2>
      <div class="messages-container">
        <div class="messages-list">
          <div class="conversations-header">
            <h3>Messages</h3>
          </div>
          <div class="conversations-scroll" id="conversationsList">
            <div class="messages-empty">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <h3>Loading...</h3>
            </div>
          </div>
        </div>
        <div class="messages-content" id="messagesContent">\n          <div class="messages-empty">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <h3>Select a conversation</h3>
            <p>Click on a conversation to view message history</p>
          </div>
        </div>
      </div>
          <div class="messages-empty">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <h3>Select a message to view</h3>
            <p>Click on a message from the list to read and reply</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="dashboard-actions">
      <a href="home.html#find-room" class="dashboard-action-card">
        <div class="dashboard-action-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </div>
        <h3 class="dashboard-action-title">Find Rooms</h3>
        <p class="dashboard-action-text">Browse thousands of student properties near your university</p>
      </a>

      <a href="#" class="dashboard-action-card">
        <div class="dashboard-action-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <h3 class="dashboard-action-title">My Profile</h3>
        <p class="dashboard-action-text">Update your preferences and personal information</p>
      </a>

      <a href="#" class="dashboard-action-card">
        <div class="dashboard-action-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
        </div>
        <h3 class="dashboard-action-title">Messages</h3>
        <p class="dashboard-action-text">Chat with landlords and potential flatmates</p>
      </a>

      <a href="home.html#advertise" class="dashboard-action-card">
        <div class="dashboard-action-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 5v14m-7-7h14"></path>
          </svg>
        </div>
        <h3 class="dashboard-action-title">List a Room</h3>
        <p class="dashboard-action-text">Advertise your property to students</p>
      </a>
    </div>

    <!-- Recent Activity -->
    <div class="dashboard-section">
      <h2 class="dashboard-section-title">Recent Activity</h2>
      <div class="dashboard-activity-list">
        <div class="dashboard-activity-item">
          <div class="dashboard-activity-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path>
            </svg>
          </div>
          <div class="dashboard-activity-content">
            <div class="dashboard-activity-title">Saved Modern Studio in Shoreditch</div>
            <div class="dashboard-activity-time">2 hours ago</div>
          </div>
        </div>

        <div class="dashboard-activity-item">
          <div class="dashboard-activity-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <div class="dashboard-activity-content">
            <div class="dashboard-activity-title">New message from Sarah (Westminster Room)</div>
            <div class="dashboard-activity-time">5 hours ago</div>
          </div>
        </div>

        <div class="dashboard-activity-item">
          <div class="dashboard-activity-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
          <div class="dashboard-activity-content">
            <div class="dashboard-activity-title">Viewing scheduled for King's Cross property</div>
            <div class="dashboard-activity-time">Yesterday at 3:30 PM</div>
          </div>
        </div>

        <div class="dashboard-activity-item">
          <div class="dashboard-activity-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
          </div>
          <div class="dashboard-activity-content">
            <div class="dashboard-activity-title">Your profile is 85% complete</div>
            <div class="dashboard-activity-time">2 days ago</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/auth-backend.js"></script>
  <script>
    // Display user name if logged in
    const student = JSON.parse(localStorage.getItem('student') || '{}');
    if (student.name) {
      document.getElementById('userName').textContent = student.name.split(' ')[0];
    }

    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      try {
        const response = await fetch('http://127.0.0.1:8000/api/logout/', {
          method: 'POST',
          credentials: 'include'
        });
        
        localStorage.removeItem('student');
        window.location.href = 'home.html';
      } catch (error) {
        console.error('Logout error:', error);
        localStorage.removeItem('student');
        window.location.href = 'home.html';
      }
    });

    // Load user's posted rooms
    async function loadMyRooms() {
      console.log('üè† Loading my rooms...');
      try {
        // Check if user is logged in
        const sessionResponse = await fetch('http://127.0.0.1:8000/api/check-session/', {
          credentials: 'include'
        });
        
        if (!sessionResponse.ok) {
          console.log('‚ùå User not logged in');
          return;
        }

        const sessionData = await sessionResponse.json();
        console.log('üë§ Current user:', sessionData.student.email);

        // Fetch all rooms
        const roomsResponse = await fetch('http://127.0.0.1:8000/api/rooms/', {
          credentials: 'include'
        });

        if (!roomsResponse.ok) {
          throw new Error('Failed to fetch rooms');
        }

        const data = await roomsResponse.json();
        const allRooms = data.rooms || data.results || data;
        console.log('üìã Total rooms:', allRooms.length);

        // Filter rooms by current user
        const myRooms = allRooms.filter(room => room.owner_email === sessionData.student.email);
        console.log('üè† My rooms:', myRooms.length);

        const myRoomsSection = document.getElementById('myRoomsSection');
        const myRoomsGrid = document.getElementById('myRoomsGrid');
        const myRoomsEmpty = document.getElementById('myRoomsEmpty');

        if (myRooms.length === 0) {
          myRoomsGrid.style.display = 'none';
          myRoomsEmpty.style.display = 'block';
          myRoomsSection.style.display = 'block';
          return;
        }

        // Display rooms
        myRoomsSection.style.display = 'block';
        myRoomsGrid.style.display = 'grid';
        myRoomsEmpty.style.display = 'none';

        myRoomsGrid.innerHTML = myRooms.map(room => {
          const firstImage = room.images && room.images.length > 0 ? room.images[0] : '';
          return `
            <div class="my-room-card" data-room-id="${room.id}">
              <img src="${firstImage}" alt="${room.title}" class="my-room-image" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
              <div class="my-room-content">
                <h3 class="my-room-title">${room.title}</h3>
                <div class="my-room-location">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  ${room.location || 'Location not specified'}
                </div>
                <div class="my-room-price">¬£${room.price}/mo</div>
                <div class="my-room-actions">
                  <button class="my-room-btn my-room-btn-view" onclick="window.location.href='room-details.html?id=${room.id}'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    View
                  </button>
                  <button class="my-room-btn my-room-btn-delete" onclick="deleteMyRoom(${room.id})">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 6h18"></path>
                      <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                      <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                    </svg>
                    Delete
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');

        console.log('‚úÖ My rooms loaded successfully');
      } catch (error) {
        console.error('‚ùå Error loading my rooms:', error);
      }
    }

    // Delete room function
    async function deleteMyRoom(roomId) {
      if (!confirm('Are you sure you want to delete this room? This action cannot be undone.')) {
        return;
      }

      console.log('üóëÔ∏è Deleting room:', roomId);

      try {
        const response = await fetch(`http://127.0.0.1:8000/api/rooms/${roomId}/`, {
          method: 'DELETE',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Failed to delete room');
        }

        console.log('‚úÖ Room deleted successfully');
        
        // Show success message (you can add a notification system)
        alert('Room deleted successfully!');
        
        // Reload the rooms list
        await loadMyRooms();
      } catch (error) {
        console.error('‚ùå Error deleting room:', error);
        alert('Error: ' + error.message);
      }
    }

    // Load my rooms on page load
    loadMyRooms();

    // Load My Reports
    async function loadMyReports() {
      console.log('üìã Loading my reports...');
      
      const reportsGrid = document.getElementById('reportsGrid');
      const reportsEmpty = document.getElementById('reportsEmpty');
      
      console.log('üìã Elements found:', { reportsGrid, reportsEmpty });
      
      try {
        const response = await fetch('http://127.0.0.1:8000/api/reports/my/', {
          credentials: 'include'
        });

        console.log('üìã Response status:', response.status);
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('‚ùå Failed to fetch reports:', response.status, errorText);
          throw new Error('Failed to fetch reports: ' + response.status);
        }

        const reports = await response.json();
        console.log('‚úÖ Reports loaded:', reports);
        console.log('‚úÖ Reports count:', reports.length);

        if (reports.length === 0) {
          console.log('üìã No reports found, showing empty state');
          reportsGrid.style.display = 'none';
          reportsEmpty.style.display = 'flex';
        } else {
          console.log('üìã Displaying', reports.length, 'reports');
          reportsGrid.style.display = 'grid';
          reportsEmpty.style.display = 'none';

          reportsGrid.innerHTML = reports.map(report => {
            const statusClass = `report-status-${report.status}`;
            const reportTypeColors = {
              'scam': '#dc3545',
              'incorrect': '#ffc107',
              'inappropriate': '#dc3545',
              'duplicate': '#17a2b8',
              'unavailable': '#6c757d',
              'discrimination': '#dc3545',
              'safety': '#dc3545',
              'other': '#6c757d'
            };
            const bgColor = reportTypeColors[report.report_type] || '#6c757d';

            return `
              <div class="report-card">
                <div class="report-card-header">
                  <span class="report-type-badge" style="background: ${bgColor}; color: white;">
                    ${report.report_type_display}
                  </span>
                  <span class="report-status-badge ${statusClass}">
                    ${report.status_display}
                  </span>
                </div>
                
                <div class="report-card-body">
                  ${report.room ? `
                    <div class="report-room-info">
                      <div class="report-room-title">${report.room.title}</div>
                      <div class="report-room-details">
                        ${report.room.location} ‚Ä¢ ¬£${report.room.price}/month
                      </div>
                    </div>
                  ` : ''}
                  
                  <div class="report-description">
                    ${report.description}
                  </div>
                </div>
                
                <div class="report-card-footer">
                  <span>Submitted: ${new Date(report.created_at).toLocaleDateString()}</span>
                  <span>Updated: ${new Date(report.updated_at).toLocaleDateString()}</span>
                </div>
              </div>
            `;
          }).join('');
          
          console.log('üìã Reports HTML updated successfully');
        }
      } catch (error) {
        console.error('‚ùå Error loading reports:', error);
        console.error('‚ùå Error details:', error.message, error.stack);
        reportsGrid.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.7);">
            Failed to load reports. Please try again later.<br>
            <small style="color: rgba(255, 255, 255, 0.5);">${error.message}</small>
          </div>
        `;
      }
    }

    // Load favorite rooms
    async function loadFavoriteRooms() {
      console.log('‚ù§Ô∏è Loading favorite rooms...');
      try {
        const response = await fetch('http://127.0.0.1:8000/api/favorites/', {
          credentials: 'include'
        });

        if (!response.ok) {
          throw new Error('Failed to fetch favorites');
        }

        const data = await response.json();
        const favoriteRooms = data.rooms || [];
        console.log('‚úÖ Favorite rooms loaded:', favoriteRooms.length);

        const favoritesSection = document.getElementById('favoritesSection');
        const favoritesGrid = document.getElementById('favoritesGrid');
        const favoritesEmpty = document.getElementById('favoritesEmpty');
        const favoritesCount = document.getElementById('favoritesCount');

        // Update count
        if (favoriteRooms.length > 0) {
          favoritesCount.textContent = `(${favoriteRooms.length})`;
        } else {
          favoritesCount.textContent = '';
        }

        if (favoriteRooms.length === 0) {
          favoritesGrid.style.display = 'none';
          favoritesEmpty.style.display = 'block';
          return;
        }

        // Display favorite rooms
        favoritesGrid.style.display = 'grid';
        favoritesEmpty.style.display = 'none';

        favoritesGrid.innerHTML = favoriteRooms.map(room => {
          const firstImage = room.images && room.images.length > 0 ? room.images[0] : '';
          return `
            <div class="my-room-card" data-room-id="${room.id}">
              <img src="${firstImage}" alt="${room.title}" class="my-room-image" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
              <div class="my-room-content">
                <h3 class="my-room-title">${room.title}</h3>
                <div class="my-room-location">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  ${room.location || 'Location not specified'}
                </div>
                <div class="my-room-price">¬£${room.price}/mo</div>
                <div class="my-room-actions">
                  <button class="my-room-btn my-room-btn-view" onclick="window.location.href='room-details.html?id=${room.id}'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    View
                  </button>
                  <button class="my-room-btn my-room-btn-delete" onclick="removeFavorite(${room.id})">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path>
                    </svg>
                    Unfavorite
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');

        console.log('‚úÖ Favorite rooms displayed successfully');
      } catch (error) {
        console.error('‚ùå Error loading favorite rooms:', error);
      }
    }

    // Remove favorite function
    async function removeFavorite(roomId) {
      if (!confirm('Remove this room from your favorites?')) {
        return;
      }

      console.log('üíî Removing favorite:', roomId);

      try {
        const response = await fetch(`http://127.0.0.1:8000/api/favorites/${roomId}/remove/`, {
          method: 'DELETE',
          credentials: 'include'
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Failed to remove favorite');
        }

        console.log('‚úÖ Favorite removed successfully');
        
        // Reload the favorites list
        await loadFavoriteRooms();
      } catch (error) {
        console.error('‚ùå Error removing favorite:', error);
        alert('Error: ' + error.message);
      }
    }

    // Load favorites on page load
    loadFavoriteRooms();

    // Section switching function
    function showSection(section) {
      // Hide all sections
      document.getElementById('favoritesSection').style.display = 'none';
      document.getElementById('myRoomsSection').style.display = 'none';
      document.getElementById('reportsSection').style.display = 'none';

      // Remove active class from all tabs
      document.querySelectorAll('.dashboard-tab').forEach(tab => {
        tab.classList.remove('active');
      });

      // Show selected section and activate tab
      if (section === 'favorites') {
        document.getElementById('favoritesSection').style.display = 'block';
        document.querySelectorAll('.dashboard-tab')[0].classList.add('active');
      } else if (section === 'myrooms') {
        document.getElementById('myRoomsSection').style.display = 'block';
        document.querySelectorAll('.dashboard-tab')[1].classList.add('active');
        loadMyRooms();
      } else if (section === 'reports') {
        document.getElementById('reportsSection').style.display = 'block';
        document.querySelectorAll('.dashboard-tab')[2].classList.add('active');
        loadMyReports();
      }
    }

    // Messages functionality
    let currentConversations = [];
    let selectedConversation = null;
    let currentUserId = null;

    // Initialize current user ID on page load
    async function initializeCurrentUser() {
      try {
        const sessionResponse = await fetch('http://127.0.0.1:8000/api/check-session/', {
          credentials: 'include'
        });
        
        if (sessionResponse.ok) {
          const sessionData = await sessionResponse.json();
          currentUserId = sessionData.student_id || sessionData.student?.id;
          console.log('‚úÖ Current User ID initialized:', currentUserId, 'Type:', typeof currentUserId);
        }
      } catch (error) {
        console.error('‚ùå Error initializing user ID:', error);
      }
    }

    // Load conversations (grouped messages)
    async function loadMessages() {
      console.log('üì¨ Loading conversations...');
      
      try {
        const response = await fetch('http://127.0.0.1:8000/api/conversations/', {
          method: 'GET',
          credentials: 'include'
        });

        if (!response.ok) {
          throw new Error('Failed to load conversations');
        }

        const data = await response.json();
        console.log('‚úÖ Conversations loaded:', data);
        
        currentConversations = data.conversations || [];
        
        // Calculate total unread count
        const unreadCount = currentConversations.reduce((sum, conv) => sum + (conv.unread_count || 0), 0);
        
        // Update unread badge
        const unreadBadge = document.getElementById('unreadBadge');
        if (unreadCount > 0) {
          unreadBadge.textContent = unreadCount;
          unreadBadge.style.display = 'inline-flex';
        } else {
          unreadBadge.style.display = 'none';
        }

        // Update total count
        const totalCount = document.getElementById('messagesTotalCount');
        if (currentConversations.length > 0) {
          totalCount.textContent = `(${currentConversations.length} conversation${currentConversations.length > 1 ? 's' : ''}, ${unreadCount} unread)`;
        } else {
          totalCount.textContent = '';
        }

        // Display conversations
        displayConversations();
        
      } catch (error) {
        console.error('‚ùå Error loading conversations:', error);
        document.getElementById('conversationsList').innerHTML = `
          <div class=\"messages-empty\">
            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">
              <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>
              <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"></line>
              <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"></line>
            </svg>
            <h3>Error loading messages</h3>
            <p>Please try again later</p>
          </div>
        `;
      }
    }

    // Display conversations list
    function displayConversations() {
      const conversationsList = document.getElementById('conversationsList');
      
      if (currentConversations.length === 0) {
        conversationsList.innerHTML = `
          <div class=\"messages-empty\" style=\"padding: 40px 20px; text-align: center;\">
            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">
              <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>
            </svg>
            <h3 style=\"font-size: 16px; margin-top: 12px;\">No Messages</h3>
            <p style=\"font-size: 13px; color: rgba(255, 255, 255, 0.6); margin-top: 8px;\">Start a conversation by contacting a landlord</p>
          </div>
        `;
        return;
      }

      const conversationsHTML = currentConversations.map(conv => {
        const initials = conv.other_user.name.split(' ').map(n => n[0]).join('').toUpperCase();
        const unreadClass = conv.unread_count > 0 ? 'unread' : '';
        const preview = conv.last_message.content.substring(0, 60);
        const timeAgo = getTimeAgo(new Date(conv.last_message.created_at));
        
        return `
          <div class=\"message-item ${unreadClass}\" data-user-id=\"${conv.other_user.id}\" data-room-id=\"${conv.room ? conv.room.id : 'null'}\" onclick=\"selectConversation(${conv.other_user.id}, ${conv.room ? conv.room.id : null})\">
            <div class=\"message-item-header\">
              <div class=\"message-sender\">${conv.other_user.name}</div>
              <div class=\"message-time\">${timeAgo}</div>
            </div>
            <div class=\"message-preview\" style=\"font-size: 13px; color: rgba(255, 255, 255, 0.7); margin-top: 6px;\">${preview}...</div>
            ${conv.room ? `<div class=\"message-room\">üìç ${conv.room.title}</div>` : ''}
          </div>
        `;
      }).join('');

      conversationsList.innerHTML = conversationsHTML;
    }

    // Select and display conversation with full message history
    async function selectConversation(otherUserId, roomId) {
      selectedConversation = currentConversations.find(c => 
        c.other_user.id === otherUserId && 
        ((c.room && c.room.id === roomId) || (!c.room && !roomId))
      );
      
      if (!selectedConversation) return;

      console.log('üí¨ Opening conversation with:', selectedConversation.other_user.name);

      // Mark as active
      document.querySelectorAll('.message-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelector(`[data-user-id=\"${otherUserId}\"][data-room-id=\"${roomId || 'null'}\"]`).classList.add('active');

      // Load full conversation history
      try {
        const response = await fetch(`http://127.0.0.1:8000/api/conversation/messages/?other_user_id=${otherUserId}&room_id=${roomId || 'null'}`, {
          method: 'GET',
          credentials: 'include'
        });

        if (!response.ok) {
          throw new Error('Failed to load conversation');
        }

        const data = await response.json();
        console.log('‚úÖ Conversation loaded:', data);

        // Display chat interface (currentUserId is already initialized)
        displayChatMessages(data.messages, selectedConversation.other_user);

        // Update unread count for this conversation
        selectedConversation.unread_count = 0;
        const totalUnread = currentConversations.reduce((sum, conv) => sum + (conv.unread_count || 0), 0);
        const unreadBadge = document.getElementById('unreadBadge');
        if (totalUnread > 0) {
          unreadBadge.textContent = totalUnread;
          unreadBadge.style.display = 'inline-flex';
        } else {
          unreadBadge.style.display = 'none';
        }

      } catch (error) {
        console.error('‚ùå Error loading conversation:', error);
        alert('Failed to load conversation. Please try again.');
      }
    }

    // Display chat messages in bubble format
    function displayChatMessages(messages, otherUser) {
      const initials = otherUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
      const myInitials = (student.name || 'ME').split(' ').map(n => n[0]).join('').toUpperCase();

      console.log('üìù Current User ID:', currentUserId, 'Type:', typeof currentUserId);
      console.log('üìù Sample message sender:', messages[0]?.sender, 'Type:', typeof messages[0]?.sender);

      const messagesHTML = messages.map(msg => {
        // Convert both to numbers for comparison to handle type mismatches
        const isSent = Number(msg.sender) === Number(currentUserId);
        const senderInitials = isSent ? myInitials : initials;
        const date = new Date(msg.created_at);
        const timeStr = date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        const dateStr = date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
        
        return `
          <div class=\"chat-message ${isSent ? 'sent' : ''}\">
            <div class=\"chat-message-avatar\">${senderInitials}</div>
            <div class=\"chat-message-content\">
              <div class=\"chat-message-bubble\">
                ${msg.content.replace(/\n/g, '<br>')}
              </div>
              <div class=\"chat-message-time\">${dateStr} at ${timeStr}</div>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('messagesContent').innerHTML = `
        <div class=\"chat-header\">
          <div class=\"chat-avatar\">${initials}</div>
          <div class=\"chat-header-info\">
            <h3>${otherUser.name}</h3>
            <p>${otherUser.email}${selectedConversation.room ? ` ‚Ä¢ üìç ${selectedConversation.room.title}` : ''}</p>
          </div>
        </div>
        <div class=\"chat-messages\" id=\"chatMessages\">
          ${messagesHTML}
        </div>
        <div class=\"chat-input-section\">
          <div class=\"chat-input-wrapper\">
            <textarea id=\"chatInput\" class=\"chat-input\" placeholder=\"Type a message...\" rows=\"1\"></textarea>
          </div>
          <button onclick=\"sendChatMessage()\" class=\"chat-send-btn\" id=\"sendBtn\">
            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">
              <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>
              <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>
            </svg>
          </button>
        </div>
      `;

      // Scroll to bottom of messages
      setTimeout(() => {
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 100);

      // Handle Enter key to send
      document.getElementById('chatInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendChatMessage();
        }
      });
    }

    // Send chat message
    async function sendChatMessage() {
      if (!selectedConversation) return;

      const chatInput = document.getElementById('chatInput');
      const content = chatInput.value.trim();

      if (content.length < 1) {
        return;
      }

      const sendBtn = document.getElementById('sendBtn');
      sendBtn.disabled = true;

      try {
        const response = await fetch('http://127.0.0.1:8000/api/messages/send/', {
          method: 'POST',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            room_id: selectedConversation.room ? selectedConversation.room.id : null,
            subject: selectedConversation.room ? selectedConversation.room.title : 'Direct Message',
            content: content,
            recipient_id: selectedConversation.other_user.id
          })
        });

        if (response.ok) {
          const data = await response.json();
          console.log('‚úÖ Message sent:', data);
          
          // Clear input
          chatInput.value = '';
          
          // Add message to chat immediately
          const myInitials = (student.name || 'ME').split(' ').map(n => n[0]).join('').toUpperCase();
          const now = new Date();
          const timeStr = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
          const dateStr = now.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
          
          const newMessageHTML = `
            <div class=\"chat-message sent\">
              <div class=\"chat-message-avatar\">${myInitials}</div>
              <div class=\"chat-message-content\">
                <div class=\"chat-message-bubble\">
                  ${content.replace(/\n/g, '<br>')}
                </div>
                <div class=\"chat-message-time\">${dateStr} at ${timeStr}</div>
              </div>
            </div>
          `;
          
          document.getElementById('chatMessages').insertAdjacentHTML('beforeend', newMessageHTML);
          
          // Scroll to bottom
          const chatMessages = document.getElementById('chatMessages');
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          // Update last message in conversation
          selectedConversation.last_message = {
            content: content,
            created_at: now.toISOString(),
            is_from_me: true
          };
          
          // Refresh conversation list
          displayConversations();
          
        } else {
          const data = await response.json();
          alert('Error: ' + (data.message || 'Failed to send message'));
        }
      } catch (error) {
        console.error('‚ùå Error sending message:', error);
        alert('Failed to send message. Please try again.');
      } finally {
        sendBtn.disabled = false;
      }
    }

    // Mark message as read (keep for compatibility)
    async function markAsRead(messageId) {
      try {
        const response = await fetch(`http://127.0.0.1:8000/api/messages/${messageId}/read/`, {
          method: 'POST',
          credentials: 'include'
        });

        if (response.ok) {
          console.log('‚úÖ Message marked as read');
        }
      } catch (error) {
        console.error('Error marking message as read:', error);
      }
    }

    // Send reply (legacy function for compatibility)
    async function sendReply() {
      if (!selectedMessage) return;

      const replyTextarea = document.getElementById('replyTextarea');
      const content = replyTextarea.value.trim();

      if (content.length < 1) {
        alert('Reply cannot be empty');
        return;
      }

      const replyBtn = event.target;
      replyBtn.disabled = true;
      replyBtn.innerHTML = 'Sending...';

      try {
        const response = await fetch('http://127.0.0.1:8000/api/messages/send/', {
          method: 'POST',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            room_id: selectedMessage.room,
            subject: `Re: ${selectedMessage.subject}`,
            content: content,
            recipient_id: selectedMessage.sender
          })
        });

        if (response.ok) {
          alert('Reply sent successfully!');
          replyTextarea.value = '';
        } else {
          const data = await response.json();
          alert('Error: ' + (data.message || 'Failed to send reply'));
        }
      } catch (error) {
        console.error('Error sending reply:', error);
        alert('Failed to send reply. Please try again.');
      } finally {
        replyBtn.disabled = false;
        replyBtn.innerHTML = `
          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">
            <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>
            <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>
          </svg>
          Send Reply
        `;
      }
    }

    // Time ago helper
    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      
      if (seconds < 60) return 'Just now';
      if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
      if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
      if (seconds < 604800) return Math.floor(seconds / 86400) + 'd ago';
      
      return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
    }

    // Initialize user and load messages on page load
    async function initializeMessaging() {
      await initializeCurrentUser();
      await loadMessages();
    }
    
    initializeMessaging();

    // Scroll to messages section when clicking nav link
    document.getElementById('messagesNavLink').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('messages-section').scrollIntoView({ behavior: 'smooth' });
    });

    // Debug: Log that reports section is loaded
    console.log('‚úÖ Portal loaded - Reports section available');
    console.log('üìã Reports section element:', document.getElementById('myReportsSection'));
    console.log('üîò Report tab buttons:', document.querySelectorAll('.dashboard-tab'));
  </script>
</body>
</html>

